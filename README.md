# Project-superconductor

### Для Программной Инженерии

Версия Python 3.9.2

Задание N2

Основная модель делает следующее - по картинке фазовой диаграммы предсказывает четыре физических параметра, которые описывают эту диаграмму.

В папке app лежит код приложения, основной эндпоинт - calculate-parameters на вход которому передается файл с картинкой, а на выход он отдает 4 параметра в виде float

Чтобы запустить приложение нужно:
1. делать всё через venv `python -m venv .venv` - создать папку с окружением
2. активировать окружение `source .venv/bin/activate`
3. выполнить `pip install -r requirements.txt`
4. в папке app выполнить `uvicorn main:app --host 127.0.0.1 --port 8080`
4.1. возможно, придётся доставить пакеты
5. Перейти по урлу http://127.0.0.1:8080
6. После открытия фронта в дропдаун можно опустить любую картинку из папки ./tests/tests_files, фронт отправит запрос на бэк и он отдаст параметры. На процессоре предсказание происходит долго, поэтому возможно нужно будет подождать 5-10 секунд
7. для работы через консоль выполнить `python3 console_predictor.py <path_to_jpg>`

### Генерация датасета(уже не для ПИ)
Файл image_generation.py генерирует изображения из исходных csv-файлов.  
Файл DataProcessor.py проходит по всем csv-файлам и с помощью image_generation.py генерирует изображения.  
Файл script_labels.py создает csv-файл с разметкой для обучения.  

## VGG16 BN  
В папке VGG16BN находятся следующие файлы:  
1. processing_data.py - подготовка изображений (сжатие с ~500х500 пикселей до 224х224), создание csv-файла с разметкой, разделение этого файла на 3 (train, val, test)
2. dataset.py - предподготовка датасета
3. VGG16BN.py - сама модель
4. train_model.py - обучение модели; после завершения обучения получаем график лоссов при обучении и валидации
5. test_model.py - теститрование модели; после завершения тестирования сохраняет csv-файл с предсказаниями
6. stats.py - расчет относительной ошибки определения; статистическая обработка результатов (min, max, mean) с выводом в консоль; создает csv-файл со следующими колонками:
   * истинные значения параметров (D, V, tb, tp)
   * предсказанные значения параметров (Dpr, Vpr, tbpr, tppr)
   * рассчитанные значения MAPE (MAPE_D, MAPE_V, MAPE_tb, MAPE_tp)

Запускать файлы в порядке: 1, 4, 5, 6

## UNET
В папке UNET находятся следующие файлы:
1) UNET_FULL_2 - вспомогательная модель UNET (с энкодером и декодером), сильно переобучена, работает как автоэнкодер. По итогу обучения генерирует сохранившиеся веса энкодера в файл encoder_weights.npy.
2) UNET_WE_5 - собственно, сама модель. Опционально, в конце можно заморозить энкодер, чтобы он сохранил веса модели FULL.
3) dataset creation - Пересоздание датасета из папки, в которой лежат исходные csv файлы и в которой есть директория result с сгенерированными изображениями в папку output_dataset_directory откуда при обучении и тестировании буду браться файлы.
4) dataset_common_functions - вспомогательный скрипт для работы dataset_creation.
5) test_model - собственно, сами метрики модели.

Порядок запуска: 1, 2, 3, 5.
   


## MFA
The mfa_scripts folder contains the following files:
1) phase_diagrammer.wls - WM script that accepts the Hamiltonian parameters D, V, J, tb, tp, tn, tpn and produces a phase diagram.
Example run:
```
phase_diagrammer.wls 0.12 0.28 1 0.5 0.4 0.4 0.05
```
2) task_parser.py - processes the sample_params.json task file
3) run_calculations.sh - runs calculations via a JSON file:
```
run_calculations.sh sample_params.json
```

